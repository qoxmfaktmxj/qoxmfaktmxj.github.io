---
layout: post
title: "ORACLE UTL_SMTP 패키지 사용 시 ACL 등록"
date: 2023-02-27 13:04:43 +0900
categories: [sql, naver-archive]
tags: [naver-import]
naver_source: https://blog.naver.com/qoxmfaktmxj/223029053086
---

> 원문: [https://blog.naver.com/qoxmfaktmxj/223029053086](https://blog.naver.com/qoxmfaktmxj/223029053086)

UTL\_SMTP 패키지 사용하여



메일을 보낼 때에는 이런식으로 만들어서 사용한다. 



 

create or replace PROCEDURE "SENDMAIL" (to\_addr in varchar2, subject in varchar2, body in varchar2\)
 IS

 crlf varchar2(2\):\=CHR(13\)\|\|CHR(10\);
 mesg varchar2(4000\);
 mailhost varchar2(30\):\= 'xxx.xxx.xxx.xxx';

 conn UTL\_SMTP.CONNECTION;

 BEGIN
 BEGIN
 
 conn:\=UTL\_SMTP.OPEN\_CONNECTION(mailhost,25\);
 
 UTL\_SMTP.helo(conn,mailhost);
 UTL\_SMTP.mail(conn,''); 

 
 UTL\_SMTP.rcpt(conn, to\_addr);

 UTL\_SMTP.open\_data(conn);
 UTL\_SMTP.WRITE\_DATA(conn,'MIME\-Version: 1\.0' \|\| UTL\_TCP.CRLF );
 UTL\_SMTP.WRITE\_DATA(conn,'Content\-Type: text/html; charset\="utf\-8"' \|\| UTL\_TCP.CRLF );
 UTL\_SMTP.WRITE\_RAW\_DATA(conn, UTL\_RAW.CAST\_TO\_RAW('From: ' \|\| 'HRIS' \|\| UTL\_TCP.CRLF) ); 
 UTL\_SMTP.WRITE\_RAW\_DATA(conn, UTL\_RAW.CAST\_TO\_RAW('To: ' \|\| to\_addr \|\| UTL\_TCP.CRLF) ); 
 UTL\_SMTP.WRITE\_DATA(conn, 'Subject: \=?UTF\-8?Q?' \|\| replace(utl\_raw.cast\_to\_varchar2(utl\_encode.quoted\_printable\_encode(utl\_raw.cast\_to\_raw(subject))), '\=' \|\| crlf, '') \|\| '?\=' \|\| UTL\_TCP.crlf); 
 UTL\_SMTP.WRITE\_DATA(conn, UTL\_TCP.CRLF ); 

 mesg :\= body;
 UTL\_SMTP.WRITE\_RAW\_DATA(conn, UTL\_RAW.CAST\_TO\_RAW(mesg \|\| UTL\_TCP.CRLF) );
 UTL\_SMTP.close\_data(conn);
 UTL\_SMTP.quit(conn);
 END;
EXCEPTION
 WHEN OTHERS THEN
 UTL\_SMTP.close\_data(conn);
 UTL\_SMTP.quit(conn);

END SENDMAIL2;

 

다만 사용하기 전에 네트워크 액세스 목록 등록을 해야 한다.



등록하지 않으면

**ORA\-24247: 네트워크 액세스가 ACL(엑세스 제어 목록)에 의해 거부되었습니다.**

위와 같은 오류 발생한다.



다른 곳에서 데이터 작업을 하여 위 프로시저를 실행할 경우에는



 **ORA\-29277:부적합한 SMTP 작업** 

오류가 발생하기도 한다.



해당 부분은



ACL을 등록하지 않았을때 발생하며 아래와 같이 등록 작업을 해 주면된다. ACL과 DESCRIPTION은 통일만 한다면 명칭 바꿔도 상관없음



 

begin

DBMS\_NETWORK\_ACL\_ADMIN.CREATE\_ACL(

acl \=\> 'network\_services.xml'

, description \=\> 'NETWORK ACL'

, principal \=\> '계정명(대소문자 구분)'

, is\_grant \=\> true

, privilege \=\> 'connect'

);

 

DBMS\_NETWORK\_ACL\_ADMIN.ADD\_PRIVILEGE(

acl \=\> 'network\_services.xml'

, principal \=\> '계정명(대소문자 구분)'

, is\_grant \=\> true

, privilege \=\> 'resolve');

 

DBMS\_NETWORK\_ACL\_ADMIN.ASSIGN\_ACL( acl \=\> 'network\_services.xml', host \=\> '\*');

commit;

end;

 


